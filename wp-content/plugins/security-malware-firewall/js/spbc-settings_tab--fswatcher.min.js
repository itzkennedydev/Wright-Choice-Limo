let noFSWChangesDetected=!0,firstFSWSelector=document.getElementById("fswatcher__first_date"),secondFSWSelector=document.getElementById("fswatcher__second_date"),fsWatcherTableBody=document.getElementById("spbc-table-fs_watcher-comparison"),availableFSWDataSetNames=["added","changed","deleted"];function FSWOnload(){document.querySelector("#fswatcher__first_date").selectedIndex=0;var e=document.querySelector("#fswatcher__second_date");e.selectedIndex=e.options.length-1,FSWCompare(new Event({}))}function FSWCompare(e){if(e.preventDefault(),null!==e.currentTarget&&(document.querySelector("#fsw_preloader_compare").style.display="inline"),void 0===document.getElementById("fswatcher__first_date")||void 0===document.getElementById("fswatcher__second_date"))return!1;var e=document.getElementById("fswatcher__first_date").value,t=document.getElementById("fswatcher__second_date").value;spbcSendAJAXRequest({action:"spbct_fswatcher_compare",fswatcher__first_date:e,fswatcher__second_date:t},{callback:function(e){let t={};if(noFSWChangesDetected=!0,"object"==typeof e)t=e;else if("string"==typeof e&&(t=FSWDecodeJSON(e)).hasOwnProperty("error"))return alert(fswatcherTranslations.fs_err_parse_json),void console.log("File System watcher JSON parse error: "+t.error);e=validateFSWResponse(t);!0===e?(renderFSWatcherTableContent(t),noFSWChangesDetected&&renderFSWTableRow("","no_changes","")):(alert(e+" "+fswatcherTranslations.fs_err_valid_result+" support@cleantalk.org"),console.log("File System watcher response validating error: "+e)),resetFSWSelectors(),toggleFSWSelectorsInfo(!0),document.querySelector("#fsw_preloader_compare").style.display="none"}})}function FSWCreate(e){e.preventDefault(),null!==e.currentTarget&&(document.querySelector("#fsw_preloader_create").style.display="inline");spbcSendAJAXRequest({action:"spbct_fswatcher_create_snapshot"},{callback:function(e){"string"==typeof e&&FSWDecodeJSON(e),document.querySelector("#fsw_preloader_create").style.display="none"},button:e.target,timeout:3e4})}function FSWViewFile(e){var t=jQuery("#wpwrap"),r=jQuery("#spbc_dialog"),n=(r.dialog({modal:!0,title:fswatcherTranslations.fs_modal+" "+e.dataset.path,position:{my:"center top",at:"center top+100px",of:window},width:t.width()/100*90,show:{effect:"blind",duration:500},draggable:!1,resizable:!1,closeText:"X",classes:{"ui-dialog":"spbc---top"},open:function(e,t){e.target.style.overflow="auto",jQuery("#spbc_dialog").height(document.documentElement.clientHeight/100*25)},beforeClose:function(e,t){document.body.style.overflow="auto",jQuery("#spbc_dialog").empty()}}),r.append('<img id="spbc_file_view_preloader" alt="Wait for downloading" class="spbc_preloader" src="../../wp-content/plugins/security-malware-firewall/images/preloader2.gif" style="display: block; position: absolute; ">'),jQuery("#spbc_file_view_preloader")),t=4e-4*t.width(),n=(n.height(128*t),n.width(128*t),n.css({left:r.width()/2-128*t/2}),n.css({top:r.height()/2-128*t/2}),jQuery("#fswatcher__first_date").val()),r=jQuery("#fswatcher__second_date").val(),t={action:"spbct_fswatcher_view_file",fswatcher_file_path:e.dataset.path,fswatcher__first_date:n,fswatcher__second_date:r};spbcSendAJAXRequest(t,{callback:function(e){let t="",r=(t=(t=void 0!==e.error?e.error:void 0!==e.data?e.data:"Unknown error on reading file. Data is empty.").split("\n"),jQuery("#spbc_dialog"));r.empty(),jQuery("#spbc_file_view_preloader").css({display:"none"});t.forEach((e,t)=>{r.append('<div class="spbc_view_file_row_wrapper"><span class="spbc_view_file_row_num">%s</span><p class="spbc_view_file_row">%s</p><br /></div>'.printf(t+1,e))});var e=19*Object.keys(t).length<76?76:19*Object.keys(t).length,n=document.documentElement.clientHeight/100*75,a=e<n?"hidden":"scroll";r.css({height:"scroll"==a?n:e,overflow:a})}})}function FSWDecodeJSON(e){try{return JSON.parse(e)}catch(e){return{error:e}}}function renderFSWatcherTableContent(e){fsWatcherTableBody.innerHTML="";for(var t of availableFSWDataSetNames)handleFSWDataObject(e,t)&&(noFSWChangesDetected=!1)}function validateFSWResponse(e){if(!e||"object"!=typeof e)return fswatcherTranslations.fs_err_resp_obj;if(void 0!==e.error)return e.error;for(var t of availableFSWDataSetNames)if(!e.hasOwnProperty(t))return fswatcherTranslations.fs_err_property;return!0}function handleFSWDataObject(e,t){var r=e[t];if(!(0<r.length))return!1;for(let e=0;e<r.length;e++){var n=convertFSWEventToRow(r[e],t);renderFSWTableRow(n.path,n.event_type,n.date)}return!0}function convertFSWEventToRow(e,t){var r,n,t={path:"unknown",event_type:t.toUpperCase(),date:"unknown"};return 2===e.length&&("string"==typeof e[0]&&(t.path=e[0],"DELETED"!==t.event_type)&&(t.path+='<br><span data-path="'+t.path+'" onclick="FSWViewFile(this);" style="cursor: pointer; color: blue;">View</span>'),"string"==typeof e[1])&&(e=new Date(1e3*Number(e[1])),shortMonthName=new Intl.DateTimeFormat("en-US",{month:"short"}).format,r=String(e.getMinutes()).padStart(2,"0"),n=String(e.getSeconds()).padStart(2,"0"),t.date=shortMonthName(e)+" "+e.getDate()+" "+e.getFullYear()+" "+e.getHours()+":"+r+":"+n),t}function renderFSWTableRow(e,t,r){var n,a;"no_changes"===t?(a=document.createElement("tr"),(n=document.createElement("td")).setAttribute("name","fswatcher-event-no-changes"),n.setAttribute("colspan","3"),n.innerText=fswatcherTranslations.fs_no_changes,a.appendChild(n),fsWatcherTableBody.appendChild(a)):(n=document.createElement("tr"),(a=document.createElement("td")).setAttribute("name","fswatcher-event-path"),a.setAttribute("data-before","Path"),a.innerHTML=e,n.appendChild(a),(e=document.createElement("td")).setAttribute("name","fswatcher-event-type"),e.setAttribute("data-before","Event"),e.innerText=t,n.appendChild(e),(a=document.createElement("td")).setAttribute("name","fswatcher-event-date"),a.setAttribute("data-before","Changed on date"),a.innerText=r,n.appendChild(a),fsWatcherTableBody.appendChild(n))}function filterFSWSecondSelector(){toggleFSWSelectorsInfo(!1)}function filterFSWFirstSelector(){toggleFSWSelectorsInfo(!1)}function resetFSWSelectors(){for(let e=0;e<firstFSWSelector.options.length;e++)firstFSWSelector.options[e].style.display="inherit";for(let e=0;e<secondFSWSelector.options.length;e++)secondFSWSelector.options[e].style.display="inherit";secondFSWSelector.removeAttribute("disabled"),firstFSWSelector.removeAttribute("disabled")}function toggleFSWSelectorsInfo(e){var t=document.getElementById("spbc--fs-watcher-table-handling-selects-info");e&&void 0!==firstFSWSelector.options[firstFSWSelector.selectedIndex]&&void 0!==secondFSWSelector.options[secondFSWSelector.selectedIndex]?(e=document.querySelectorAll("#spbc-table-fs_watcher-comparison > tr").length,e=0<document.getElementsByName("fswatcher-event-no-changes").length?0:e,t.style.display="inherit",t.innerHTML=fswatcherTranslations.fs_comparing+" <b>"+firstFSWSelector.options[firstFSWSelector.selectedIndex].text+"</b> "+fswatcherTranslations.fs_with+" <b>"+secondFSWSelector.options[secondFSWSelector.selectedIndex].text+"</b> "+fswatcherTranslations.fs_total+" <b>"+e+"</b>"):(t.innerText="",t.style.display="none")}"loading"!==document.readyState?FSWOnload():document.addEventListener("DOMContentLoaded",FSWOnload),document.getElementById("fswatcher__compare").addEventListener("click",FSWCompare),document.getElementById("fswatcher__create_snapshot").addEventListener("click",FSWCreate),firstFSWSelector.addEventListener("change",filterFSWSecondSelector),secondFSWSelector.addEventListener("change",filterFSWFirstSelector);
//# sourceMappingURL=spbc-settings_tab--fswatcher.min.js.map
