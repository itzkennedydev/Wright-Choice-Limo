let spbcBulkAction=null,noConfirmActions=spbcGetNoConfirmActions(spbcPublic);function spbcReloadAccordion(c=null,s=""){spbcSendAJAXRequest({action:"spbc_scanner_tab__reload_accordion"},{notJson:!0,callback:function(e,t,n,a){jQuery(a).accordion("destroy"),jQuery(a).html(e),jQuery(a).accordion({header:"h3",heightStyle:"content",collapsible:!0,active:!1}),spbcTblBulkActionsListen(),spbcTblRowActionsListen(),spbcTblPaginationListen(),spbcTblSortListen(),spbcStartShowHide(),null!==c&&null!==s&&interactScannerTab(c,s)}},jQuery("#spbc_scan_accordion"))}function interactScannerTab(e,t){var n,a;"string"==typeof e&&""!==e&&"string"==typeof t&&""!==t&&(n=jQuery('#spbc_scan_accordion div[refresh_control_tab="'+e+'"]')[0],e="h3[aria-controls=spbc_scan_accordion_tab_"+e+"]",e=jQuery(e)[0],void 0!==n)&&void 0!==e&&(jQuery('<div class="spbc_accordion_header_caption__update_status"></div>').appendTo(e),a=jQuery(".spbc_accordion_header_caption__update_status"),jQuery('<div class="spbc_accordion_header_caption__updated">'+t+"</div>").appendTo(a),e.click(),n.setAttribute("class","ui-accordion-header ui-corner-top ui-state-default ui-accordion-icons ui-accordion-header-active"),jQuery(".row-actions").hide())}function spbcTblBulkActionsListen(){jQuery(".tbl-bulk_actions-all--apply").off("click").on("click",function(){if(spbcScanner.active)alert(spbcTableLocalize.scannerIsActive);else{var e=jQuery(this);let n=e.siblings("select").children()[e.siblings("select").first()[0].selectedIndex].value;if(-1!==["approve","disapprove","send","check_analysis_status","approve_page","disapprove_page","cure","delete_from_analysis_log","restore"].indexOf(n)){if(noConfirmActions.any.includes(n)||confirm(spbcTable.warning_bulk)){var t={action:"spbc_tbl-action--bulk",add_action:n,status:e.parents(".tbl-root").attr("type")};if("cure"===n)spbcScannerCureBulk(e,!0);else{if("restore"===n&&spbcScannerRestoreBulk(e,!0),"delete_from_analysis_log"===n){var a=e.closest("#spbc_tbl__scanner_analysis_log").find(".cb-select");let n=[];a.each(function(e,t){t=jQuery(t).val();n.push(t)}),t.file_ids=n}a={button:this,spinner:e.children(".tbl-preloader--small"),callback:function(e){var t;spbcReloadAccordion(),"check_analysis_status"===n&&void 0!==e&&(t="<p> Analysis status updated. Total: "+e.counters.total+", updated: "+e.counters.updated+", skipped: "+e.counters.skipped+", failed: "+e.counters.failed+", queued: "+e.counters.queued+"</p>",spbcModal.open().put(t)),"send"===n&&void 0!==e&&(t="<p> Files have been sent: "+e.files_sent_counter+"</p>",spbcModal.open().put(t))},errorOutput:function(e,t){t&&(e=e+"<br>Additional information:<br>"+t),spbcModal.open().putError(e)},timeout:6e4};spbcSendAJAXRequest(t,a)}}}else alert("This action is not supported for all files yet =(")}}),jQuery(".tbl-bulk_actions--apply").off("click").on("click",function(e){var n=spbcBulkAction||jQuery(this);let a=n.siblings("select").children()[n.siblings("select").first()[0].selectedIndex].value;if(spbcBulkAction||noConfirmActions.any.includes(a)||confirm(spbcTable.warning_bulk))if(spbcBulkAction=n,"cure"===a)spbcScannerCureBulk(jQuery(this),!1);else if("restore"===a)spbcScannerRestoreBulk(jQuery(this),!1);else if("delete_from_analysis_log"===a)spbcScannerAnalysisLogDeleteFromLog(jQuery(this));else if("allow"===a||"ban"===a){let t="ban"===a?"deny":a;var c=n.parents(".tbl-root").find(".cb-select:checked"),c=(c&&(n.children(".tbl-preloader--small").show(),c.each(function(){var e=jQuery(this).parents("tr").find(".tbl-row_action--"+a).data("ip");spbcSecLogsFilterIp(e,t,!0),jQuery(this).prop("checked",!1)})),n.children(".tbl-preloader--small").hide(),"allow"===a?"Allowed":"Banned"),c="<p> Success. Selected IPs have been "+c+". Changes will be applied within 10 minutes.</p>";spbcModal.open().put(c),void setTimeout(spbcReloadAccordion,1900)}else"-1"!==a&&n.parents(".tbl-root").find(".cb-select").is(":checked")?(n.children(".tbl-preloader--small").show(),n.parents(".tbl-root").find(".cb-select:checked").first().parents("tr").find(".tbl-row_action--"+a)[0]?(n.parents(".tbl-root").find(".cb-select:checked").first().parents("tr").find(".tbl-row_action--"+a).click(),n.parents(".tbl-root").find(".cb-select:checked").first().prop("checked",!1)):(n.parents(".tbl-root").find(".cb-select:checked").first().prop("checked",!1),n.click())):(n.children(".tbl-preloader--small").hide(),spbcBulkAction=null,"check_analysis_status"!==a&&"disapprove"!==a||spbcModal.open().put("<p> All available files are updated.</p>"),"send"===a&&spbcModal.open().put("<p> All available files are sent.</p>"),setTimeout(spbcReloadAccordion,1900)),noConfirmActions.restricted.includes(a)&&(spbcBulkAction=null)})}function spbcScannerCureBulk(l,e=!1){let n=[];var e=e?".cb-select":".cb-select:checked";let t=l.closest("#spbc_tbl__scanner_cure_log").find(e);0===(t=0===t.length?l.closest("#spbc_scan_accordion_tab_critical").find(e):t).length?alert("Please, select elements."):(t.each(function(e,t){t=jQuery(t).val();n.push(t)}),e={action:"spbc_cure_selected",security:spbcSettings.ajax_nonce,selectedIds:n},jQuery.ajax({type:"POST",url:spbcSettings.ajaxurl,data:e,beforeSend:function(){l.closest("#spbc_tbl__scanner_cure_log").find(".tbl-button---white_blue .tbl-preloader--in_button").show()},success:function(e){l.closest("#spbc_tbl__scanner_cure_log").find(".tbl-button---white_blue .tbl-preloader--in_button").hide();var t=e.data,n=document.createElement("div"),a=document.createElement("p"),c=document.createElement("p"),s=document.createElement("div"),o=document.createElement("b"),i=document.createElement("p"),o=(o.innerHTML="See more details in the threats log.",i.append(o),t.hasOwnProperty("failed_to_cure")?t.failed_to_cure:[]);0<o.length&&(s.innerHTML=o.join("</br>")),a.innerHTML=t.message,c.innerHTML+="Cured: "+(t.hasOwnProperty("cured_on_request")?t.cured_on_request:0),c.innerHTML+=", already cured: "+(t.hasOwnProperty("skipped")?t.skipped:0),c.innerHTML+=", failed to cure: "+o.length,n.append(a),n.append(c),n.append(s),0<o.length&&n.append(i),e.success?spbcModal.open().put(n.outerHTML):spbcModal.open().putError(n.outerHTML),document.addEventListener("spbcModalClosed",function(e){spbcReloadAccordion()})}}))}function spbcScannerRestoreBulk(i,e=!1){let n=[];var e=e?".cb-select":".cb-select:checked",e=i.closest("#spbc_tbl__scanner_cure_log").find(e);0===e.length?alert("Please, select elements."):(e.each(function(e,t){t=jQuery(t).val();n.push(t)}),e={action:"spbc_restore_selected",security:spbcSettings.ajax_nonce,selectedIds:n},jQuery.ajax({type:"POST",url:spbcSettings.ajaxurl,data:e,beforeSend:function(){i.closest("#spbc_tbl__scanner_cure_log").find(".tbl-button---white_blue .tbl-preloader--in_button").show()},success:function(e){i.closest("#spbc_tbl__scanner_cure_log").find(".tbl-button---white_blue .tbl-preloader--in_button").hide();var t=e.data,n=document.createElement("div"),a=document.createElement("p"),c=document.createElement("p"),s=document.createElement("div"),o=t.hasOwnProperty("failed_to_restore")?t.failed_to_restore:[];0<o.length&&(s.innerHTML=o.join("</br>")),a.innerHTML=t.message,c.innerHTML+="Restored: "+(t.hasOwnProperty("restored_on_request")?t.restored_on_request:0),c.innerHTML+=", unchanged or already restored: "+(t.hasOwnProperty("skipped")?t.skipped:0),c.innerHTML+=", failed to restore: "+o.length,n.append(a),n.append(c),n.append(s),e.success?spbcModal.open().put(n.outerHTML):spbcModal.open().putError(n.outerHTML),document.addEventListener("spbcModalClosed",function(e){spbcReloadAccordion()})}}))}function spbcTblRowActionsListen(){jQuery(".tbl-row_action--ajax").off("click").on("click",function(){if(spbcScanner.active)alert(spbcTableLocalize.scannerIsActive);else{let t=jQuery(this),n={action:"spbc_tbl-action--row",add_action:t.attr("row-action"),id:t.parents(".row-actions").attr("uid"),cols:t.parents(".row-actions").attr("cols_amount"),page_url:t.parent().attr("uid"),page_id:t.parent().attr("page_id")},a={callback:spbcTblRowActionsCallback,errorOutput:function(e,t,n){spbcModal.open().putError(e,n)},spinner:t.parent().siblings(".tbl-preloader--tiny")};"delete"===t.attr("row-action")&&(a.timeout=6e4);var e,c,s=t.parent().parent()[0].firstChild.innerHTML,o=spbcTable["warning_h_"+t.attr("row-action")]||spbcTable.warning_default,i=spbcTable["warning_t_"+t.attr("row-action")]||"";spbcBulkAction||noConfirmActions.any.includes(n.add_action)?spbcSendAJAXRequest(n,a,t.parents("tr")):(e="quarantine"===t.attr("row-action")?"Quarantine":"Yes",c="quarantine"===t.attr("row-action")?"Cancel":"No",spbcModal.open().confirm(o,i,s,e=>{e&&spbcSendAJAXRequest(n,a,t.parents("tr"))},e,c))}})}function spbcGetNoConfirmActions(e){var t={any:[],restricted:[],defaults:[]};let n=t;try{"function"==typeof(n=void 0!==e&&e.hasOwnProperty("no_confirm_row_actions")?JSON.parse(e.no_confirm_row_actions):n).any.includes&&"function"==typeof n.restricted.includes&&"function"==typeof n.defaults.includes||(n=t)}catch(e){n=t}return n}function spbcTblRowActionsCallback(t,n,e,a){if(t.color&&a.css({background:t.background,color:t.color}),t.html&&(a.parent().parent().parent().prepend(t.html),setTimeout(function(){a.fadeOut(300)},1500),spbcBulkAction||setTimeout(spbcReloadAccordion,1900)),"copy_file_info"===n.add_action&&(!0===t.success&&t.data.file_info?window.prompt("Copy the file info below and send it to support@cleantalk.org: ",t.data.file_info):(c=void 0!==t.data.error?t.data.error:"Unknown copy_file_info error",spbcModal.open().putError(c))),t.temp_html){let e=a.html();if(a.html(t.temp_html),void 0!==t.updated_template){var c=t.updated_template_type,t=t.updated_template,s=jQuery(t).find(".wp-list-table tbody tr").length,o=jQuery('[aria-controls="spbc_scan_accordion_tab_'+c+'"]');if(0<o.length){var i=jQuery("#spbc_tbl__scanner_"+c);jQuery(".spbc_bad_type_count."+c+"_counter").text(s);let n=i.find(".wp-list-table tbody tr").length;i.remove(),jQuery("#spbc_scan_accordion_tab_"+c).append(t),jQuery(jQuery("#spbc_scan_accordion_tab_"+c).find(".wp-list-table tbody tr")).each(function(e,t){++e>n&&jQuery(t).css("outline","1px solid green")}),o.click()}else"analysis_log"===c&&(i='<h3 class="ui-accordion-header ui-corner-top ui-state-default ui-accordion-icons ui-accordion-header-collapsed ui-corner-all" role="tab" id="ui-id-2" aria-controls="spbc_scan_accordion_tab_analysis_log" aria-selected="false" aria-expanded="false" tabindex="-1"><span class="ui-accordion-header-icon ui-icon ui-icon-triangle-1-e"></span><a href="#">Analysis Log (<span class="spbc_bad_type_count analysis_log_counter">'+s+"</span>)</a></h3>",c='<div id="spbc_scan_accordion_tab_analysis_log" class="ui-accordion-content ui-corner-bottom ui-helper-reset ui-widget-content" aria-labelledby="ui-id-2" role="tabpanel" aria-hidden="true" style="display: none;"><p class="spbc_hint">Files sent for analysis.</p><div id="spbc_tbl__scanner_analysis_log" type="analysis_log" class="tbl-root">'+t+"</div>",jQuery("#spbc_scan_accordion_tab_critical").after(i+c),o.click())}setTimeout(function(){a.html(e).css({background:"inherit"}).find(".column-primary .row-actions .tbl-row_action--"+n.add_action).remove(),spbcTblBulkActionsListen(),spbcTblRowActionsListen(),spbcStartShowHide()},5e3)}spbcBulkAction&&spbcBulkAction.click()}function spbcTblPaginationListen(){let n={action:"spbc_tbl-pagination"},a={callback:spbcTblPaginationCallback,notJson:!0};jQuery(".tbl-pagination--button").on("click",function(){jQuery(this).parents(".tbl-root").find(".tbl-pagination--button").attr("disabled","disabled")}),jQuery(".tbl-pagination--go").on("click",function(){var e=jQuery(this),t=e.parents(".tbl-root");n.page=e.siblings(".tbl-pagination--curr_page").val(),n.type=t.attr("type"),a.spinner=e.siblings(".tbl-preloader--small"),spbcSendAJAXRequest(n,a,t)}),jQuery(".tbl-pagination--prev").on("click",function(){var e=jQuery(this),t=e.parents(".tbl-root");n.page=e.parents(".tbl-pagination--wrapper").attr("prev_page"),n.type=t.attr("type"),a.spinner=e.siblings(".tbl-preloader--small"),spbcSendAJAXRequest(n,a,t)}),jQuery(".tbl-pagination--next").on("click",function(){var e=jQuery(this),t=e.parents(".tbl-root");n.page=e.parents(".tbl-pagination--wrapper").attr("next_page"),n.type=t.attr("type"),a.spinner=e.siblings(".tbl-preloader--small"),spbcSendAJAXRequest(n,a,t)}),jQuery(".tbl-pagination--end").on("click",function(){var e=jQuery(this),t=e.parents(".tbl-root");n.page=e.parents(".tbl-pagination--wrapper").attr("last_page"),n.type=t.attr("type"),a.spinner=e.siblings(".tbl-preloader--small"),spbcSendAJAXRequest(n,a,t)}),jQuery(".tbl-pagination--start").on("click",function(){var e=jQuery(this),t=e.parents(".tbl-root");n.page=1,n.type=t.attr("type"),a.spinner=e.siblings(".tbl-preloader--small"),spbcSendAJAXRequest(n,a,t)})}function spbcTblPaginationCallback(e,t,n,a){jQuery(a).html(e).find(".tbl-pagination--button").removeAttr("disabled"),spbcTblBulkActionsListen(),spbcTblRowActionsListen(),spbcTblPaginationListen(),spbcTblSortListen(),spbcStartShowHide()}function spbcTblSortListen(){let a={callback:spbcTblSortCallback,notJson:!0};jQuery(".tbl-column-sortable").on("click",function(e){var t,n;e.target.classList.contains("tbl-sorting_indicator")&&(n="links"==(t=(e=jQuery(this)).parents(".tbl-root")).attr("type")?jQuery("#spbc_tbl__scanner__outbound_links b").html():"",e={action:"spbc_tbl-sort",order_by:e.attr("id"),order:e.attr("sort_direction"),type:t.attr("type"),domain:n},spbcSendAJAXRequest(e,a,t))})}function spbcTblSortCallback(e,t,n,a){jQuery(a).html(e),spbcTblBulkActionsListen(),spbcTblRowActionsListen(),spbcTblPaginationListen(),spbcTblSortListen()}function spbcScannerSwitchTable(e,t){var e=jQuery(e),n=e.parents(".row-actions").attr("uid");spbcSendAJAXRequest({action:"spbc_tbl-switch",type:t,domain:n},{callback:spbcTblPaginationCallback,notJson:!0},e.parents(".tbl-root"))}function spbcShowHideRows(e,t){t=jQuery("."+t+"_block_"+e);t.hasClass("mob_table_active")?t.removeClass("mob_table_active"):t.addClass("mob_table_active")}function spbcEATUpdateIntervalStart(){setInterval(()=>{null!==document.querySelector('div[refresh_control_tab="analysis_log"]')&&(spbcEATAddSpinner(),spbcUpdateTableEAT(),spbcUpdateStatsEAT())},6e4)}function spbcEATAddSpinner(){var e,t;null===document.getElementById("analysis_log_counter_spinner")&&null!==(e=document.querySelector('h3[aria-controls="spbc_scan_accordion_tab_analysis_log"]'))&&((t=document.createElement("img")).class="spbc_preloader",t.alt=spbcSettings.spbcSpinner.altText,t.src=spbcSettings.spbcSpinner.imgSource,t.id="analysis_log_counter_spinner",t.style="display: none; height: 13px; position: relative; top: 2px; margin-left: 5px",e.append(t)),spbcEATSwitchSpinner()}function spbcEATSwitchSpinner(){var e=document.getElementById("analysis_log_counter_spinner");null!==e&&(e.style.display="none"===e.style.display?e.style.display="inline":e.style.display="none")}function spbcUpdateTableEAT(){var e={action:"spbc_settings__draw_elements",tab_name:"scanner",security:spbcSettings.ajax_nonce};spbcSendAJAXRequest(e,{callback:spbcUpdateTableCallbackEAT,notJson:!0,additional:null},null)}function spbcUpdateTableCallbackEAT(e){var t="#spbc_tbl__scanner_analysis_log";let n="",a=null;null!==(e=(new DOMParser).parseFromString(e,"text/html").querySelector(t))&&""!==e.innerHTML&&(n=e.innerHTML),null!==(a=null!==(a=document.querySelector(t))&&""===a.innerHTML?null:a)&&""!==n&&(a.innerHTML=n)}function spbcUpdateStatsEAT(){var e={action:"spbc_analysyis_files_stats__get_html",sub_action:"give_me_html",security:spbcSettings.ajax_nonce};spbcSendAJAXRequest(e,{callback:spbcUpdateStatsCallbackEAT,notJson:!0})}function spbcUpdateStatsCallbackEAT(e){var t=document.getElementById("spbc_analysis_files_stats");t&&(t.innerHTML=e),spbcEATSwitchSpinner()}jQuery(document).ready(function(){spbcTblBulkActionsListen(),spbcTblRowActionsListen(),spbcTblPaginationListen(),spbcTblSortListen(),spbcEATUpdateIntervalStart()});
//# sourceMappingURL=spbc-table.min.js.map
